services:
  inspire_to_arc:
    image: inspire_to_arc:latest
    build:
      context: ..
      dockerfile: docker/Dockerfile.inspire_to_arc
    environment:
      CLIENT_KEY_DATA: ${data}
    tmpfs:
      - /run/secrets:mode=1777
    volumes:
      - ./config.yaml:/etc/inspire_to_arc/config.yaml:ro
      - ./client.crt:/etc/inspire_to_arc/client.crt:ro
    command: >
      sh -c "printf '%s' \"$$CLIENT_KEY_DATA\" > /run/secrets/client.key &&
            python -m middleware.inspire_to_arc.main -c /etc/inspire_to_arc/config.yaml"
    restart: no
